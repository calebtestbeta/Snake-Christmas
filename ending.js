window.Ending = (() => {
    // è–èª•ç¥ç¦èˆ‡å±¬éˆå‹‰å‹µè¨Šæ¯
    const blessingLines = {
        // é«˜ä¿¡å¿ƒæˆé•·
        highFaith: "ä½ çš„ä¿¡å¿ƒå¦‚ç£çŸ³èˆ¬ç©©å›ºï¼Œç¥å¿…è³œç¦ä½ ä¸€åˆ‡çš„é“è·¯ã€‚ã€Œä½ å€‘ç¥ˆæ±‚ï¼Œå°±çµ¦ä½ å€‘ï¼›å°‹æ‰¾ï¼Œå°±å°‹è¦‹ï¼›å©é–€ï¼Œå°±çµ¦ä½ å€‘é–‹é–€ã€‚ã€- é¦¬å¤ªç¦éŸ³ 7:7",
        
        // é«˜æ„›å¿ƒæˆé•·  
        highLove: "æ„›å¿ƒæ»¿æº¢çš„ä½ ï¼Œæ­£å¦‚åŸºç£æ„›æˆ‘å€‘ä¸€æ¨£æ„›äººã€‚ã€Œæˆ‘å€‘æ„›ï¼Œå› ç‚ºç¥å…ˆæ„›æˆ‘å€‘ã€‚ã€- ç´„ç¿°ä¸€æ›¸ 4:19",
        
        // é«˜ç›¼æœ›æˆé•·
        highHope: "ä½ çš„å¿ƒå……æ»¿ç›¼æœ›ï¼Œå¦‚åŒä»°æœ›æ™¨æ˜Ÿçš„äººã€‚ã€Œä½†é‚£ç­‰å€™è€¶å’Œè¯çš„å¿…å¾æ–°å¾—åŠ›ã€‚ä»–å€‘å¿…å¦‚é·¹å±•ç¿…ä¸Šé¨°ã€‚ã€- ä»¥è³½äºæ›¸ 40:31",
        
        // é«˜å¹³å®‰æˆé•·
        highPeace: "å¹³å®‰å¦‚æ±Ÿæ²³åœ¨ä½ å¿ƒä¸­æµæ·Œï¼Œç¥çš„åŒåœ¨èˆ‡ä½ åŒè¡Œã€‚ã€Œä½ å€‘è¦å°‡ä¸€åˆ‡çš„æ†‚æ…®å¸çµ¦ç¥ï¼Œå› ç‚ºä»–é¡§å¿µä½ å€‘ã€‚ã€- å½¼å¾—å‰æ›¸ 5:7",
        
        // é«˜å–œæ¨‚æˆé•·
        highJoy: "ä½ çš„å–œæ¨‚æ˜¯å¾ä¸Šé ­ä¾†çš„æ©è³œï¼Œè®“äººçœ‹è¦‹ç¥çš„æ¦®å…‰ã€‚ã€Œä½ å€‘è¦é ä¸»å¸¸å¸¸å–œæ¨‚ï¼Œæˆ‘å†èªªï¼Œä½ å€‘è¦å–œæ¨‚ã€‚ã€- è…“ç«‹æ¯”æ›¸ 4:4",
        
        // é«˜è®šç¾æˆé•·
        highPraise: "ä½ çš„è®šç¾å¦‚é¦™ä¸Šå‡åˆ°ç¥é¢å‰ï¼Œè’™ç¥æ‚…ç´ã€‚ã€Œå‡¡æœ‰æ°£æ¯çš„éƒ½è¦è®šç¾è€¶å’Œè¯ï¼ã€- è©©ç¯‡ 150:6",
        
        // é«˜æ™ºæ…§æˆé•·
        highWisdom: "ä½ è¡Œèµ°åœ¨æ™ºæ…§çš„é“è·¯ä¸Šï¼Œè…³æ­¥ç©©å¥ä¸åé›¢ã€‚ã€Œæ•¬ç•è€¶å’Œè¯æ˜¯æ™ºæ…§çš„é–‹ç«¯ï¼›èªè­˜è‡³è–è€…ä¾¿æ˜¯è°æ˜ã€‚ã€- ç®´è¨€ 9:10",
        
        // è–èª•ç‰¹æ®Šç¥ç¦
        christmasBlessing: "é¡˜è–èª•çš„å¹³å®‰å–œæ¨‚å¸¸èˆ‡ä½ åŒåœ¨ï¼Œå¦‚åŒç•¶å¹´å¤©ä½¿å ±ä½³éŸ³èˆ¬çš„ç¾å¥½ã€‚ã€Œå› æœ‰ä¸€å¬°å­©ç‚ºæˆ‘å€‘è€Œç”Ÿï¼›æœ‰ä¸€å­è³œçµ¦æˆ‘å€‘ã€‚ã€- ä»¥è³½äºæ›¸ 9:6",
        
        // å¤šé‡è©å¥å®Œæˆ
        multiPhrase: "ä½ æ”¶é›†äº†è¨±å¤šç¾å¥½çš„è©å¥ï¼Œé¡˜é€™äº›ç¥ç¦å¦‚ç¨®å­åœ¨å¿ƒä¸­ç™¼èŠ½æˆé•·ã€‚ã€Œç¥èƒ½ç…§è‘—é‹è¡Œåœ¨æˆ‘å€‘å¿ƒè£¡çš„å¤§åŠ›å……å……è¶³è¶³åœ°æˆå°±ä¸€åˆ‡ã€‚ã€- ä»¥å¼—æ‰€æ›¸ 3:20",
        
        // å‡è¡¡æˆé•·
        balanced: "ä½ çš„å±¬éˆç”Ÿå‘½æˆé•·å‡è¡¡ï¼Œå¦‚æ¨¹æ ½åœ¨æºªæ°´æ—ã€‚ã€Œä»–è¦åƒä¸€æ£µæ¨¹æ ½åœ¨æºªæ°´æ—ï¼ŒæŒ‰æ™‚å€™çµæœå­ï¼Œè‘‰å­ä¹Ÿä¸æ¯ä¹¾ã€‚ã€- è©©ç¯‡ 1:3",
        
        // åˆæ¬¡é«”é©—
        beginner: "æ¯ä¸€å€‹ç¾å¥½çš„é–‹å§‹éƒ½æ˜¯ç¥æ©å…¸çš„è¨˜è™Ÿï¼Œé¡˜ä½ åœ¨ä¿¡ä»°è·¯ä¸Šæ»¿æœ‰ç›¼æœ›ã€‚ã€Œæ‡‰ç•¶ä¸€ç„¡æ›æ…®ï¼Œåªè¦å‡¡äº‹è—‰è‘—ç¦±å‘Šã€ç¥ˆæ±‚ï¼Œå’Œæ„Ÿè¬ï¼Œå°‡ä½ å€‘æ‰€è¦çš„å‘Šè¨´ç¥ã€‚ã€- è…“ç«‹æ¯”æ›¸ 4:6",
        
        // å®Œå…¨æ²’æœ‰æ”¶ç©«æ™‚çš„é¼“å‹µ
        noHarvest: "æ²’é—œä¿‚ï¼æ¯ä¸€æ¬¡å˜—è©¦éƒ½æ˜¯æˆé•·çš„é–‹å§‹ã€‚ã€Œå‡¡å‹è‹¦æ“”é‡æ“”çš„äººå¯ä»¥åˆ°æˆ‘é€™è£¡ä¾†ï¼Œæˆ‘å°±ä½¿ä½ å€‘å¾—å®‰æ¯ã€‚ã€- é¦¬å¤ªç¦éŸ³ 11:28",
        
        // è±ç››æ”¶ç©«
        abundant: "ä½ æ”¶ç©«æ»¿æ»¿çš„ç¥ç¦ï¼Œå¦‚åŒæ…ˆæ„›çš„ç¥è³œçµ¦å…’å¥³å¥½æ±è¥¿ã€‚ã€Œä½ å€‘é›–ç„¶ä¸å¥½ï¼Œå°šä¸”çŸ¥é“æ‹¿å¥½æ±è¥¿çµ¦å…’å¥³ï¼›ä½•æ³ä½ å€‘åœ¨å¤©ä¸Šçš„çˆ¶ï¼Œè±ˆä¸æ›´æŠŠå¥½æ±è¥¿çµ¦æ±‚ä»–çš„äººå—ï¼Ÿã€- é¦¬å¤ªç¦éŸ³ 7:11"
    };

    // è–èª•ç¯€è–ç¶“ç¶“æ–‡ç¥ç¦æ± 
    const randomBlessings = {
        // è–èª•é™ç”Ÿç³»åˆ— - åŸºç£èª•ç”Ÿçš„å¥‡è¹Ÿ
        nativityScriptures: [
            "ğŸ„ã€Œå› æœ‰ä¸€å¬°å­©ç‚ºæˆ‘å€‘è€Œç”Ÿï¼›æœ‰ä¸€å­è³œçµ¦æˆ‘å€‘ã€‚æ”¿æ¬Šå¿…æ“”åœ¨ä»–çš„è‚©é ­ä¸Šï¼›ä»–åç¨±ç‚ºå¥‡å¦™ç­–å£«ã€å…¨èƒ½çš„ç¥ã€æ°¸åœ¨çš„çˆ¶ã€å’Œå¹³çš„å›ã€‚ã€- ä»¥è³½äºæ›¸ 9:6",
            "â­ã€Œå¿…æœ‰ç«¥å¥³æ‡·å­•ç”Ÿå­ï¼Œçµ¦ä»–èµ·åå«ä»¥é¦¬å…§åˆ©ï¼ˆå°±æ˜¯ç¥èˆ‡æˆ‘å€‘åŒåœ¨çš„æ„æ€ï¼‰ã€‚ã€- é¦¬å¤ªç¦éŸ³ 1:23",
            "ğŸ‘¼ã€Œå¤©ä½¿å°ä»–å€‘èªªï¼šä¸è¦æ‡¼æ€•ï¼æˆ‘å ±çµ¦ä½ å€‘å¤§å–œçš„ä¿¡æ¯ï¼Œæ˜¯é—œä¹è¬æ°‘çš„ï¼›å› ä»Šå¤©åœ¨å¤§è¡›çš„åŸè£¡ï¼Œç‚ºä½ å€‘ç”Ÿäº†æ•‘ä¸»ï¼Œå°±æ˜¯ä¸»åŸºç£ã€‚ã€- è·¯åŠ ç¦éŸ³ 2:10-11",
            "ğŸŒŸã€Œé‚£æ˜Ÿå¿½ç„¶åœ¨ä»–å€‘å‰é ­è¡Œï¼Œç›´è¡Œåˆ°å°å­©å­çš„åœ°æ–¹ï¼Œå°±åœ¨ä¸Šé ­åœä½äº†ã€‚ä»–å€‘çœ‹è¦‹é‚£æ˜Ÿï¼Œå°±å¤§å¤§çš„æ­¡å–œã€‚ã€- é¦¬å¤ªç¦éŸ³ 2:9-10"
        ],

        // å¤©ä½¿å ±ä½³éŸ³ç³»åˆ— - å¤©ä½¿çš„å®£å‘Š
        angelicMessages: [
            "ğŸ“¯ã€Œåœ¨è‡³é«˜ä¹‹è™•æ¦®è€€æ­¸èˆ‡ç¥ï¼åœ¨åœ°ä¸Šå¹³å®‰æ­¸èˆ‡ä»–æ‰€å–œæ‚…çš„äººï¼ã€- è·¯åŠ ç¦éŸ³ 2:14",
            "ğŸ•Šï¸ã€Œå¤©ä½¿å°é¦¬åˆ©äºèªªï¼šé¦¬åˆ©äºï¼Œä¸è¦æ€•ï¼ä½ åœ¨ç¥é¢å‰å·²ç¶“è’™æ©äº†ã€‚ã€- è·¯åŠ ç¦éŸ³ 1:30",
            "âœ¨ã€Œé¦¬åˆ©äºèªªï¼šæˆ‘å¿ƒå°Šä¸»ç‚ºå¤§ï¼›æˆ‘éˆä»¥ç¥æˆ‘çš„æ•‘ä¸»ç‚ºæ¨‚ã€‚ã€- è·¯åŠ ç¦éŸ³ 1:46-47",
            "ğŸºã€Œå¿½ç„¶ï¼Œæœ‰ä¸€å¤§éšŠå¤©å…µåŒé‚£å¤©ä½¿è®šç¾ç¥èªª...ã€- è·¯åŠ ç¦éŸ³ 2:13"
        ],

        // å…‰æ˜èˆ‡ç›¼æœ›ç³»åˆ— - åŸºç£æ˜¯ä¸–ç•Œçš„å…‰
        lightAndHope: [
            "ğŸ’¡ã€Œé‚£å…‰æ˜¯çœŸå…‰ï¼Œç…§äº®ä¸€åˆ‡ç”Ÿåœ¨ä¸–ä¸Šçš„äººã€‚ã€- ç´„ç¿°ç¦éŸ³ 1:9",
            "ğŸŒ…ã€Œåœ¨é»‘æš—ä¸­è¡Œèµ°çš„ç™¾å§“çœ‹è¦‹äº†å¤§å…‰ï¼›ä½åœ¨æ­»è”­ä¹‹åœ°çš„äººæœ‰å…‰ç…§è€€ä»–å€‘ã€‚ã€- ä»¥è³½äºæ›¸ 9:2",
            "ğŸ”¥ã€Œè€¶ç©Œåˆå°çœ¾äººèªªï¼šæˆ‘æ˜¯ä¸–ç•Œçš„å…‰ã€‚è·Ÿå¾æˆ‘çš„ï¼Œå°±ä¸åœ¨é»‘æš—è£¡èµ°ï¼Œå¿…è¦å¾—è‘—ç”Ÿå‘½çš„å…‰ã€‚ã€- ç´„ç¿°ç¦éŸ³ 8:12",
            "ğŸŒŸã€Œæˆ‘å€‘åœ¨æ±æ–¹çœ‹è¦‹ä»–çš„æ˜Ÿï¼Œç‰¹ä¾†æ‹œä»–ã€‚ã€- é¦¬å¤ªç¦éŸ³ 2:2"
        ],

        // æ„›èˆ‡æ•‘è´–ç³»åˆ— - ç¥çš„æ„›é€éåŸºç£å½°é¡¯
        loveAndSalvation: [
            "â¤ï¸ã€Œç¥æ„›ä¸–äººï¼Œç”šè‡³å°‡ä»–çš„ç¨ç”Ÿå­è³œçµ¦ä»–å€‘ï¼Œå«ä¸€åˆ‡ä¿¡ä»–çš„ï¼Œä¸è‡³æ»…äº¡ï¼Œåå¾—æ°¸ç”Ÿã€‚ã€- ç´„ç¿°ç¦éŸ³ 3:16",
            "ğŸ’ã€ŒæƒŸæœ‰åŸºç£åœ¨æˆ‘å€‘é‚„ä½œç½ªäººçš„æ™‚å€™ç‚ºæˆ‘å€‘æ­»ï¼Œç¥çš„æ„›å°±åœ¨æ­¤å‘æˆ‘å€‘é¡¯æ˜äº†ã€‚ã€- ç¾…é¦¬æ›¸ 5:8",
            "ğŸ¤—ã€Œæˆ‘å€‘æ„›ï¼Œå› ç‚ºç¥å…ˆæ„›æˆ‘å€‘ã€‚ã€- ç´„ç¿°ä¸€æ›¸ 4:19",
            "ğŸ’–ã€Œä¸»æ‰€æ‡‰è¨±æˆ‘å€‘çš„å°±æ˜¯æ°¸ç”Ÿã€‚ã€- ç´„ç¿°ä¸€æ›¸ 2:25"
        ],

        // å¹³å®‰èˆ‡å–œæ¨‚ç³»åˆ— - è–èª•å¸¶ä¾†çš„å¹³å®‰
        peaceAndJoy: [
            "ğŸ•Šï¸ã€Œæˆ‘ç•™ä¸‹å¹³å®‰çµ¦ä½ å€‘ï¼›æˆ‘å°‡æˆ‘çš„å¹³å®‰è³œçµ¦ä½ å€‘ã€‚æˆ‘æ‰€è³œçš„ï¼Œä¸åƒä¸–äººæ‰€è³œçš„ã€‚ä½ å€‘å¿ƒè£¡ä¸è¦æ†‚æ„ï¼Œä¹Ÿä¸è¦è†½æ€¯ã€‚ã€- ç´„ç¿°ç¦éŸ³ 14:27",
            "ğŸµã€Œä½ å€‘è¦é ä¸»å¸¸å¸¸å–œæ¨‚ã€‚æˆ‘å†èªªï¼Œä½ å€‘è¦å–œæ¨‚ã€‚ã€- è…“ç«‹æ¯”æ›¸ 4:4",
            "ğŸŒˆã€Œä½†é¡˜ä½¿äººæœ‰ç›¼æœ›çš„ç¥ï¼Œå› ä¿¡å°‡è«¸èˆ¬çš„å–œæ¨‚ã€å¹³å®‰å……æ»¿ä½ å€‘çš„å¿ƒï¼Œä½¿ä½ å€‘è—‰è‘—è–éˆçš„èƒ½åŠ›å¤§æœ‰ç›¼æœ›ï¼ã€- ç¾…é¦¬æ›¸ 15:13",
            "ğŸ¶ã€Œæ‡‰ç•¶ä¸€ç„¡æ›æ…®ï¼Œåªè¦å‡¡äº‹è—‰è‘—ç¦±å‘Šã€ç¥ˆæ±‚ï¼Œå’Œæ„Ÿè¬ï¼Œå°‡ä½ å€‘æ‰€è¦çš„å‘Šè¨´ç¥ã€‚ã€- è…“ç«‹æ¯”æ›¸ 4:6"
        ]
    };

    // è–èª•ç¯€ç‰¹åˆ¥ç¶“æ–‡ç¥ç¦
    const christmasSpecialBlessings = [
        "ğŸ„ã€Œé“æˆäº†è‚‰èº«ï¼Œä½åœ¨æˆ‘å€‘ä¸­é–“ï¼Œå……å……æ»¿æ»¿çš„æœ‰æ©å…¸æœ‰çœŸç†ã€‚æˆ‘å€‘ä¹Ÿè¦‹éä»–çš„æ¦®å…‰ï¼Œæ­£æ˜¯çˆ¶ç¨ç”Ÿå­çš„æ¦®å…‰ã€‚ã€- ç´„ç¿°ç¦éŸ³ 1:14",
        "â­ã€Œå¾ä»–è±æ»¿çš„æ©å…¸è£¡ï¼Œæˆ‘å€‘éƒ½é ˜å—äº†ï¼Œè€Œä¸”æ©ä¸ŠåŠ æ©ã€‚ã€- ç´„ç¿°ç¦éŸ³ 1:16",
        "ğŸ‘‘ã€Œå› ç‚ºä»Šå¤©åœ¨å¤§è¡›çš„åŸè£¡ï¼Œç‚ºä½ å€‘ç”Ÿäº†æ•‘ä¸»ï¼Œå°±æ˜¯ä¸»åŸºç£ã€‚ã€- è·¯åŠ ç¦éŸ³ 2:11",
        "ğŸ•Šï¸ã€Œé¡˜é Œè®šæ­¸èˆ‡æˆ‘å€‘ä¸»è€¶ç©ŒåŸºç£çš„çˆ¶ç¥ï¼ä»–åœ¨åŸºç£è£¡æ›¾è³œçµ¦æˆ‘å€‘å¤©ä¸Šå„æ¨£å±¬éˆçš„ç¦æ°£ã€‚ã€- ä»¥å¼—æ‰€æ›¸ 1:3"
    ];

    // æ„Ÿæ©è®šç¾ç¶“æ–‡
    const gratitudeBlessings = [
        "ğŸ™ã€Œå‡¡æœ‰æ°£æ¯çš„éƒ½è¦è®šç¾è€¶å’Œè¯ï¼ä½ å€‘è¦è®šç¾è€¶å’Œè¯ï¼ã€- è©©ç¯‡ 150:6",
        "ğŸµã€Œè¦ä»¥æ„Ÿè¬ç‚ºç¥­ç»çµ¦ç¥ï¼Œåˆè¦å‘è‡³é«˜è€…é‚„ä½ çš„é¡˜ã€‚ã€- è©©ç¯‡ 50:14",
        "âœ¨ã€Œä½ å€‘è¦çµ¦è€¶å’Œè¯æ¦®è€€ï¼Œå› ä»–çš„æ…ˆæ„›æ°¸é é•·å­˜ã€‚ã€- è©©ç¯‡ 136:1",
        "ğŸ’«ã€Œç•¶ç¨±è¬é€²å…¥ä»–çš„é–€ï¼›ç•¶è®šç¾é€²å…¥ä»–çš„é™¢ã€‚ç•¶æ„Ÿè¬ä»–ï¼Œç¨±é Œä»–çš„åï¼ã€- è©©ç¯‡ 100:4"
    ];

    // ç‰¹æ®Šè–èª•èˆ‡ä¿¡ä»°è©å¥çš„é¡å¤–ç¥ç¦
    const specialPhraseBlessings = {
        "è–èª•å¿«æ¨‚": "ğŸ„ è–èª•çš„çœŸè«¦æ˜¯æ„›èˆ‡åˆ†äº«ï¼Œé¡˜ä½ çš„ç”Ÿå‘½å¦‚æ˜Ÿå…‰èˆ¬ç…§äº®ä»–äººã€‚",
        "è€¶ç©Œæ„›æˆ‘": "âœï¸ é€™æ˜¯æœ€å¯¶è²´çš„çœŸç†ï¼Œé¡˜ä½ åœ¨ä¸»çš„æ„›ä¸­å¾—è‘—å®Œå…¨çš„å¹³å®‰ã€‚",
        "å“ˆåˆ©è·¯äº": "ğŸ™ ä½ çš„è®šç¾ä¸Šé”å¤©åº­ï¼Œé¡˜ç¥çš„æ¦®è€€å……æ»¿ä½ çš„ç”Ÿå‘½ã€‚",
        "ä»¥é¦¬å…§åˆ©": "â­ ç¥èˆ‡æˆ‘å€‘åŒåœ¨ï¼Œåœ¨æ¯ä¸€å¤©çš„ç”Ÿæ´»ä¸­éƒ½ç¶“æ­·ç¥‚çš„åŒè¡Œã€‚",
        "å¹³å®‰å–œæ¨‚": "ğŸ•Šï¸ é€™æ˜¯å¤©çˆ¶è³œçµ¦å…’å¥³æœ€ç¾çš„ç¦®ç‰©ï¼Œé¡˜ä½ æ™‚æ™‚ç¶“æ­·ã€‚",
        "æ©å…¸å¤ ç”¨": "ğŸ’ ç¥çš„æ©å…¸åœ¨è»Ÿå¼±ä¸­é¡¯å¾—å®Œå…¨ï¼Œç¥‚çš„æ„›æ°¸ä¸é›¢æ£„ã€‚",
        "ä¿¡æœ›æ„›": "ğŸ’– é€™ä¸‰æ¨£æ˜¯åŸºç£å¾’ç”Ÿå‘½çš„æ ¹åŸºï¼Œå…¶ä¸­æœ€å¤§çš„æ˜¯æ„›ã€‚",
        "å ±ä½³éŸ³": "ğŸ“¯ å¦‚åŒç•¶å¹´çš„å¤©ä½¿ï¼Œé¡˜ä½ ä¹Ÿæˆç‚ºå‚³éç¦éŸ³çš„ä½¿è€…ã€‚",
        "å¹³å®‰å¤œ": "ğŸŒ™ åœ¨é€™å¯§éœçš„å¤œæ™šï¼Œæ„Ÿå—ç¥åŒåœ¨çš„ç¾å¥½èˆ‡æº«æš–ã€‚"
    };

    // åˆ†æå±¬éˆæˆé•·ç‹€æ³
    function analyze(spiritualStat, completedPhrases = []) {
        const faith = spiritualStat.faith || 0;
        const love = spiritualStat.love || 0;
        const hope = spiritualStat.hope || 0;
        const peace = spiritualStat.peace || 0;
        const joy = spiritualStat.joy || 0;
        const praise = spiritualStat.praise || 0;
        const wisdom = spiritualStat.wisdom || 0;
        const trust = spiritualStat.trust || 0;
        
        const totalGrowth = faith + love + hope + peace + joy + praise + wisdom + trust;
        
        // æª¢æŸ¥æ˜¯å¦å®Œå…¨æ²’æœ‰æ”¶ç©«
        if (totalGrowth === 0 && completedPhrases.length === 0) {
            return "noHarvest";
        }
        
        // æª¢æŸ¥æ˜¯å¦æœ‰è–èª•ç›¸é—œè©å¥
        const hasChristmasPhrase = completedPhrases.some(phrase => 
            ['è–èª•å¿«æ¨‚', 'å¹³å®‰å¤œ', 'å ±ä½³éŸ³'].includes(phrase)
        );
        
        // æª¢æŸ¥å¤šé‡è©å¥å®Œæˆ
        const phraseCount = completedPhrases.length;
        
        // åˆ†æé‚è¼¯ - å„ªå…ˆè€ƒæ…®ç‰¹æ®Šæƒ…æ³
        if (hasChristmasPhrase) {
            return "christmasBlessing";
        }
        
        if (phraseCount >= 5) {
            return "multiPhrase";
        }
        
        if (totalGrowth >= 80) {
            return "abundant";
        }
        
        if (totalGrowth < 20) {
            return "beginner";
        }
        
        // æ ¹æ“šæœ€é«˜çš„å±¬éˆæˆé•·æŒ‡æ¨™æ±ºå®š
        const maxValue = Math.max(faith, love, hope, peace, joy, praise, wisdom);
        
        if (faith === maxValue && faith >= 30) {
            return "highFaith";
        }
        if (love === maxValue && love >= 35) {
            return "highLove";
        }
        if (hope === maxValue && hope >= 25) {
            return "highHope";
        }
        if (peace === maxValue && peace >= 30) {
            return "highPeace";
        }
        if (joy === maxValue && joy >= 35) {
            return "highJoy";
        }
        if (praise === maxValue && praise >= 30) {
            return "highPraise";
        }
        if (wisdom === maxValue && wisdom >= 20) {
            return "highWisdom";
        }
        
        return "balanced";
    }

    // ç²å–ç¥ç¦è¨Šæ¯
    function getBlessingLine(tag) {
        return blessingLines[tag] || blessingLines.balanced;
    }

    // ç²å–è©å¥ç‰¹æ®Šç¥ç¦
    function getPhraseBlessing(phrase) {
        return specialPhraseBlessings[phrase] || "";
    }

    // æ™ºèƒ½éš¨æ©Ÿç¥ç¦é¸æ“‡å™¨
    function getRandomBlessingByCategory(spiritualStat, completedPhrases = []) {
        const faith = spiritualStat.faith || 0;
        const love = spiritualStat.love || 0;
        const hope = spiritualStat.hope || 0;
        const peace = spiritualStat.peace || 0;
        const joy = spiritualStat.joy || 0;
        const praise = spiritualStat.praise || 0;
        
        // æ ¹æ“šå±¬éˆæˆé•·å‚¾å‘é¸æ“‡å°æ‡‰çš„è–ç¶“ç¶“æ–‡é¡åˆ¥
        let selectedCategory = 'nativityScriptures'; // é è¨­è–èª•é™ç”Ÿç¶“æ–‡
        
        // æª¢æŸ¥æ˜¯å¦æœ‰è–èª•ç›¸é—œè©å¥ - å„ªå…ˆè–èª•é™ç”Ÿç¶“æ–‡
        const hasChristmasPhrase = completedPhrases.some(phrase => 
            ['è–èª•å¿«æ¨‚', 'å¹³å®‰å¤œ', 'å ±ä½³éŸ³', 'ä»¥é¦¬å…§åˆ©'].includes(phrase)
        );
        
        if (hasChristmasPhrase) {
            selectedCategory = 'nativityScriptures';
        } else if (faith > 20 || praise > 15 || completedPhrases.some(p => ['å“ˆåˆ©è·¯äº', 'è®šç¾'].some(w => p.includes(w)))) {
            // ä¿¡å¿ƒæˆ–è®šç¾è¼ƒé«˜ - å¤©ä½¿å ±ä½³éŸ³
            selectedCategory = 'angelicMessages';
        } else if (love > 25 || completedPhrases.some(p => p.includes('æ„›'))) {
            // æ„›å¿ƒè¼ƒé«˜ - æ„›èˆ‡æ•‘è´–ç¶“æ–‡
            selectedCategory = 'loveAndSalvation';
        } else if (hope > 15 || joy > 20) {
            // ç›¼æœ›æˆ–å–œæ¨‚è¼ƒé«˜ - å…‰æ˜èˆ‡ç›¼æœ›ç¶“æ–‡
            selectedCategory = 'lightAndHope';
        } else if (peace > 20) {
            // å¹³å®‰è¼ƒé«˜ - å¹³å®‰èˆ‡å–œæ¨‚ç¶“æ–‡
            selectedCategory = 'peaceAndJoy';
        } else {
            // éš¨æ©Ÿé¸æ“‡ä¸€å€‹è–ç¶“ç¶“æ–‡é¡åˆ¥
            const categories = ['nativityScriptures', 'angelicMessages', 'lightAndHope', 'loveAndSalvation', 'peaceAndJoy'];
            selectedCategory = categories[Math.floor(Math.random() * categories.length)];
        }
        
        // å¾é¸å®šé¡åˆ¥ä¸­éš¨æ©Ÿé¸æ“‡ä¸€å¥è–ç¶“ç¶“æ–‡
        const categoryBlessings = randomBlessings[selectedCategory];
        if (categoryBlessings && categoryBlessings.length > 0) {
            return categoryBlessings[Math.floor(Math.random() * categoryBlessings.length)];
        }
        
        return randomBlessings.nativityScriptures[0]; // å‚™ç”¨ç¶“æ–‡
    }

    // ç²å–é¡å¤–çš„è–ç¶“ç¥ç¦
    function getExtraBlessings() {
        const extraBlessings = [];
        
        // éš¨æ©Ÿæ·»åŠ è–èª•ç‰¹åˆ¥ç¶“æ–‡ç¥ç¦
        if (Math.random() < 0.6) {
            const specialBlessing = christmasSpecialBlessings[Math.floor(Math.random() * christmasSpecialBlessings.length)];
            extraBlessings.push(specialBlessing);
        }
        
        // éš¨æ©Ÿæ·»åŠ æ„Ÿæ©è®šç¾ç¶“æ–‡
        if (Math.random() < 0.5) {
            const gratitudeBlessing = gratitudeBlessings[Math.floor(Math.random() * gratitudeBlessings.length)];
            extraBlessings.push(gratitudeBlessing);
        }
        
        return extraBlessings;
    }

    // ç²å–æ²’æœ‰æ”¶ç©«æ™‚çš„é¼“å‹µè¨Šæ¯
    function getNoHarvestEncouragement() {
        const encouragements = [
            "æ²’é—œä¿‚ï¼æ¯ä¸€æ¬¡å˜—è©¦éƒ½æ˜¯æˆé•·çš„é–‹å§‹ã€‚ã€Œå‡¡å‹è‹¦æ“”é‡æ“”çš„äººå¯ä»¥åˆ°æˆ‘é€™è£¡ä¾†ï¼Œæˆ‘å°±ä½¿ä½ å€‘å¾—å®‰æ¯ã€‚ã€- é¦¬å¤ªç¦éŸ³ 11:28",
            "åˆ¥ç°å¿ƒï¼ç¥çœ‹é‡ä½ é¡˜æ„å˜—è©¦çš„å¿ƒã€‚ã€Œä½ å€‘ç¥ˆæ±‚ï¼Œå°±çµ¦ä½ å€‘ï¼›å°‹æ‰¾ï¼Œå°±å°‹è¦‹ï¼›å©é–€ï¼Œå°±çµ¦ä½ å€‘é–‹é–€ã€‚ã€- é¦¬å¤ªç¦éŸ³ 7:7", 
            "å¤±æ•—æ˜¯æˆåŠŸä¹‹æ¯ï¼ã€Œæˆ‘é è‘—é‚£åŠ çµ¦æˆ‘åŠ›é‡çš„ï¼Œå‡¡äº‹éƒ½èƒ½åšã€‚ã€- è…“ç«‹æ¯”æ›¸ 4:13",
            "å†è©¦ä¸€æ¬¡å§ï¼ç¥çš„æ©å…¸å¤ ä½ ç”¨ã€‚ã€Œæˆ‘çš„æ©å…¸å¤ ä½ ç”¨çš„ï¼Œå› ç‚ºæˆ‘çš„èƒ½åŠ›æ˜¯åœ¨äººçš„è»Ÿå¼±ä¸Šé¡¯å¾—å®Œå…¨ã€‚ã€- å“¥æ—å¤šå¾Œæ›¸ 12:9",
            "ä¸è¦æ”¾æ£„ï¼ç¥æ­£åœ¨é å‚™ç¾å¥½çš„äº‹ã€‚ã€Œæˆ‘å€‘æ›‰å¾—è¬äº‹éƒ½äº’ç›¸æ•ˆåŠ›ï¼Œå«æ„›ç¥çš„äººå¾—ç›Šè™•ã€‚ã€- ç¾…é¦¬æ›¸ 8:28",
            "ç¹¼çºŒåŠªåŠ›ï¼ä½ çš„å …æŒç¥éƒ½çœ‹è¦‹ã€‚ã€Œæ‰€ä»¥ï¼Œæˆ‘è¦ªæ„›çš„å¼Ÿå…„å€‘ï¼Œä½ å€‘å‹™è¦å …å›ºï¼Œä¸å¯æ–å‹•ï¼Œå¸¸å¸¸ç«­åŠ›å¤šåšä¸»å·¥ã€‚ã€- å“¥æ—å¤šå‰æ›¸ 15:58"
        ];
        
        return encouragements[Math.floor(Math.random() * encouragements.length)];
    }

    // ç”Ÿæˆå®Œæ•´çš„å±¬éˆæˆé•·å ±å‘Š
    function generateGrowthReport(spiritualStat, completedPhrases = [], collectedChars = []) {
        const totalChars = collectedChars.length;
        const totalGrowth = Object.values(spiritualStat).reduce((sum, val) => sum + (val || 0), 0);
        
        // æª¢æŸ¥æ˜¯å¦å®Œå…¨æ²’æœ‰æ”¶ç©«
        if (totalChars === 0 && totalGrowth === 0) {
            return `ğŸŒ± ${getNoHarvestEncouragement()}\n\nğŸ’¡ å°æç¤ºï¼š\nâ€¢ ä½¿ç”¨æ–¹å‘éµæˆ–é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ§åˆ¶è›‡çš„ç§»å‹•\nâ€¢ æ”¶é›†è–èª•å­—ç¬¦è®“è›‡è®Šé•·ä¸¦ç²å¾—ç¥ç¦\nâ€¢ è©¦è‘—çµ„æˆã€Œè–èª•å¿«æ¨‚ã€ã€ã€Œå¹³å®‰å–œæ¨‚ã€ç­‰è©å¥\nâ€¢ æ¯å€‹å­—ç¬¦éƒ½æœ‰ä¸åŒçš„å±¬éˆæ„ç¾©ï¼Œæ…¢æ…¢æ¢ç´¢å§ï¼\n\nâœ¨ å†è©¦ä¸€æ¬¡ï¼Œé¡˜ç¥çš„æ„›èˆ‡ä½ åŒåœ¨ï¼`;
        }
        
        let report = "";
        
        // æ·»åŠ è©å¥å®Œæˆçµ±è¨ˆ
        if (completedPhrases.length > 0) {
            report += "ğŸ¯ å®Œæˆçš„ç¾å¥½è©å¥ï¼š\n";
            completedPhrases.forEach(phrase => {
                const specialBlessing = getPhraseBlessing(phrase);
                report += `â€¢ ${phrase}`;
                if (specialBlessing) {
                    report += ` - ${specialBlessing}`;
                }
                report += "\n";
            });
            report += "\n";
        }
        
        // åªé¡¯ç¤ºä¸€å¥æ™ºèƒ½é¸æ“‡çš„è–ç¶“ç¶“æ–‡ç¥ç¦
        const randomBlessing = getRandomBlessingByCategory(spiritualStat, completedPhrases);
        report += `ğŸ’ ${randomBlessing}\n\n`;
        
        // å±¬éˆæˆé•·çµ±è¨ˆ
        report += `ğŸ“Š æœ¬æ¬¡æ”¶ç©«ï¼š${totalChars} å€‹å­—ç¬¦ï¼Œ${totalGrowth} é»å±¬éˆæˆé•·\n\n`;
        
        // æœ€é«˜æˆé•·é ˜åŸŸ
        const maxGrowthArea = Object.entries(spiritualStat).reduce((max, [key, value]) => {
            return (value || 0) > (max.value || 0) ? { area: key, value } : max;
        }, { area: '', value: 0 });
        
        const areaNames = {
            faith: 'ä¿¡å¿ƒ', love: 'æ„›å¿ƒ', hope: 'ç›¼æœ›', 
            peace: 'å¹³å®‰', joy: 'å–œæ¨‚', praise: 'è®šç¾', 
            wisdom: 'æ™ºæ…§', trust: 'ä¿¡é '
        };
        
        if (maxGrowthArea.value > 0) {
            report += `âœ¨ ä½ åœ¨ã€Œ${areaNames[maxGrowthArea.area] || maxGrowthArea.area}ã€æ–¹é¢æˆé•·æœ€å¤šï¼`;
        }
        
        return report;
    }

    // å°å¤–ä»‹é¢ (ä¿æŒèˆ‡åŸç‰ˆç›¸å®¹)
    function line(tag) {
        return getBlessingLine(tag);
    }

    return { 
        analyze, 
        line,
        getBlessingLine,
        getPhraseBlessing,
        generateGrowthReport,
        getRandomBlessingByCategory,
        getExtraBlessings,
        getNoHarvestEncouragement
    };
})();